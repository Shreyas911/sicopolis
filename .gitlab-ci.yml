default:
        image: shreyas911/sicopolis_ad_v2:v1.3

stages:
        - test

tests:
        stage: test
        only:
               - develop
        before_script:
               - export NETCDF_F90_FLAG=-I/usr/lib64/gfortran/modules
               - export LISDIR=/lis-2.0.30/installation
               - export LIB_NETCDF_F90_FLAG='-L/usr/lib64 -lnetcdff'
               - export TAPENADE_HOME=/builds/sicopolis/sicopolis/test_ad/tapenade_supported
               - export PATH=$PATH:$TAPENADE_HOME/bin
               - pwd
               - ls -a ./*
               - echo $PATH
               - echo $TAPENADE_HOME
               - source $HOME/.bashrc
        script:
               - ./get_input_files.sh
               - cd test_ad
               - cp sico_specs_v5_ant40_b2_ss25ka.h ../runs/headers
               - cp sico_specs_v5_grl16_bm5_ss25ka.h ../runs/headers
               - cp sico_specs_v5_ant64_b2_future09_ctrl.h ../runs/headers
               - cp -r pop_push ../src/
               - pytest tests.py
